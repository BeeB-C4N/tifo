<!DOCTYPE html>
<html lang="ja">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>TIFO - è¦³å…‰çŒ«å‹ã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒªãƒ¼</title>
Â  Â  <meta name="apple-mobile-web-app-capable" content="yes">
Â  Â  <meta name="apple-mobile-web-app-status-bar-style" content="defalt">
Â  Â  <link rel="icon" href="../favicon.ico">
Â  Â  <link rel="apple-touch-icon" href="../tifo.png">
Â  Â  <link rel="manifest" href="./manifest.json">
Â  Â  <script src="https://cdn.tailwindcss.com"></script>
Â  Â  <link rel="preconnect" href="https://fonts.googleapis.com">
Â  Â  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
Â  Â  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
Â  Â  <style>
Â  Â  Â  Â  :root {
Â  Â  Â  Â  Â  Â  --tifo-bg: #F7FAFC;
Â  Â  Â  Â  Â  Â  --tifo-text: #2D3748;
Â  Â  Â  Â  Â  Â  --tifo-primary: #4FD1C5;
Â  Â  Â  Â  Â  Â  --tifo-primary-dark: #38B2AC;
Â  Â  Â  Â  Â  Â  --tifo-card-border: #E2E8F0;
Â  Â  Â  Â  Â  Â  --tifo-card-bg: #FFFFFF;
Â  Â  Â  Â  }
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  font-family: 'Noto Sans JP', sans-serif;
Â  Â  Â  Â  Â  Â  background-color: var(--tifo-bg);
Â  Â  Â  Â  Â  Â  color: var(--tifo-text);
Â  Â  Â  Â  }
Â  Â  Â  Â  .tifo-card {
Â  Â  Â  Â  Â  Â  background-color: var(--tifo-card-bg);
Â  Â  Â  Â  Â  Â  border-radius: 1.5rem;
Â  Â  Â  Â  Â  Â  padding: 1.5rem;
Â  Â  Â  Â  Â  Â  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
Â  Â  Â  Â  Â  Â  border: 1px solid var(--tifo-card-border);
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  justify-content: space-between;
Â  Â  Â  Â  }
Â  Â  Â  Â  .tifo-button {
Â  Â  Â  Â  Â  Â  background-color: var(--tifo-primary);
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  padding: 0.75rem 1.5rem;
Â  Â  Â  Â  Â  Â  border-radius: 9999px;
Â  Â  Â  Â  Â  Â  border-bottom: 4px solid var(--tifo-primary-dark);
Â  Â  Â  Â  Â  Â  transition: all 0.2s ease;
Â  Â  Â  Â  }
Â  Â  Â  Â  .tifo-button:hover {
Â  Â  Â  Â  Â  Â  transform: translateY(-2px);
Â  Â  Â  Â  Â  Â  box-shadow: 0 6px 12px -3px rgba(79, 209, 197, 0.4);
Â  Â  Â  Â  }
Â  Â  Â  Â  .tifo-button:active {
Â  Â  Â  Â  Â  Â  transform: translateY(2px);
Â  Â  Â  Â  Â  Â  border-bottom-width: 2px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .rank-badge {
Â  Â  Â  Â  Â  Â  width: 2rem; height: 2rem; border-radius: 50%; display: inline-flex;
Â  Â  Â  Â  Â  Â  align-items: center; justify-content: center; font-weight: bold; color: white;
Â  Â  Â  Â  Â  Â  flex-shrink: 0;
Â  Â  Â  Â  }
Â  Â  Â  Â  .rank-1 { background-color: #FFD700; }
Â  Â  Â  Â  .rank-2 { background-color: #C0C0C0; }
Â  Â  Â  Â  .rank-3 { background-color: #CD7F32; }
Â  Â  Â  Â  .rank-4, .rank-5 { background-color: #A9A9A9; }
Â  Â  Â  Â  .progress-bar-bg { background-color: #EDF2F7; border-radius: 9999px; overflow: hidden; height: 1.25rem; }
Â  Â  Â  Â  .progress-bar {
Â  Â  Â  Â  Â  Â  background-color: var(--tifo-primary);
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  border-radius: 9999px;
Â  Â  Â  Â  Â  Â  transition: width 0.5s ease-in-out;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  font-size: 0.8rem;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  }
Â  Â  Â  Â  .nps-bar-container { position: relative; background: linear-gradient(to right, #FEB2B2, #EDF2F7, #9AE6B4); height: 0.75rem; border-radius: 9999px; }
Â  Â  Â  Â  .nps-bar-marker { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 2px; height: 1.25rem; background-color: rgba(113, 128, 150, 0.5); border-radius: 1px; }
Â  Â  Â  Â  .nps-bar-value { position: absolute; top: 50%; transform: translateY(-50%); width: 0.75rem; height: 0.75rem; background-color: var(--tifo-text); border-radius: 50%; border: 2px solid white; box-shadow: 0 0 5px rgba(0,0,0,0.3); transition: left 0.5s ease-in-out; }
Â  Â  Â  Â  .modal-overlay {
Â  Â  Â  Â  Â  Â  position: fixed; top: 0; left: 0; right: 0; bottom: 0;
Â  Â  Â  Â  Â  Â  background-color: rgba(45, 55, 72, 0.75);
Â  Â  Â  Â  Â  Â  display: flex; align-items: center; justify-content: center;
Â  Â  Â  Â  Â  Â  z-index: 50;
Â  Â  Â  Â  Â  Â  transition: opacity 0.3s ease;
Â  Â  Â  Â  }
Â  Â  Â  Â  .modal-overlay.hidden {
Â  Â  Â  Â  Â  Â  opacity: 0;
Â  Â  Â  Â  Â  Â  pointer-events: none;
Â  Â  Â  Â  }
Â  Â  Â  Â  .modal-content {
Â  Â  Â  Â  Â  Â  background-color: white;
Â  Â  Â  Â  Â  Â  padding: 2rem;
Â  Â  Â  Â  Â  Â  border-radius: 1.5rem;
Â  Â  Â  _B_ Â  Â  max-width: 90%;
Â  Â  Â  Â  Â  Â  width: 650px;
Â  Â  Â  Â  Â  Â  max-height: 85vh;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04);
Â  Â  Â  Â  Â  Â  transition: transform 0.3s ease, opacity 0.3s ease;
Â  Â  Â  Â  }
Â  Â  Â  Â  .modal-overlay.hidden .modal-content {
Â  Â  Â  Â  Â  Â  Â transform: translateY(-20px);
Â  Â  Â  Â  Â  Â  Â opacity: 0;
Â  Â  Â  Â  }
Â  Â  Â  Â  .feedback-tab-button {
Â  Â  Â  Â  Â  Â  padding: 0.5rem 0.75rem;
Â  Â  Â  Â  Â  Â  border-bottom: 3px solid transparent;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  Â  Â  color: #A0AEC0;
Â  Â  Â  Â  Â  Â  transition: all 0.2s ease;
Â  Â  Â  Â  Â  Â  flex-shrink: 0;
Â  Â  Â  Â  }
Â  Â  Â  Â  .feedback-tab-button:hover {
Â  Â  Â  Â  Â  Â  background-color: #F7FAFC;
Â  Â  Â  Â  Â  Â  color: #4A5568;
Â  Â  Â  Â  }
Â  Â  Â  Â  .feedback-tab-button.active {
Â  Â  Â  Â  Â  Â  color: var(--tifo-primary);
Â  Â  Â  Â  Â  Â  border-bottom-color: var(--tifo-primary);
Â  Â  Â  Â  }
Â  Â  Â  Â  .feedback-content {
Â  Â  Â  Â  Â  Â  height: 40rem;
Â  Â  Â  Â  Â  Â  overflow-y: auto;
Â  Â  Â  Â  }
Â  Â  Â  Â  .custom-scrollbar::-webkit-scrollbar { width: 8px; }
Â  Â  Â  Â  .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
Â  Â  Â  Â  .custom-scrollbar::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 10px; }
Â  Â  Â  Â  .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #9ca3af; }
Â  Â  </style>
</head>
<body>
Â  Â  Â  Â  <div id="home-screen" class="min-h-screen flex flex-col items-center justify-center p-4 text-center">
Â  Â  Â  Â  <div class="flex items-center justify-center gap-4 mb-4">
Â  Â  Â  Â  Â  Â  <div class="w-24 h-24">
Â  Â  Â  Â  Â  Â  Â  Â  <a href="https://codefornoto.github.io/TIFO/" target="_blank" rel="noopener noreferrer">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <path fill="var(--tifo-primary)" d="M47.9,-51.9C62.4,-41.2,74.7,-25.9,78.2,-8.1C81.7,9.7,76.4,30.1,64.8,44.2C53.2,58.3,35.3,66.1,17.7,70.8C0.1,75.5,-17.2,77.1,-33.1,70.2C-49,63.3,-63.5,47.9,-71.4,30.1C-79.3,12.3,-80.6,-7.8,-74.3,-24.1C-68,-40.4,-54.1,-52.9,-38.8,-60.1C-23.5,-67.3,-6.8,-69.2,8.9,-66.1C24.6,-63,47.9,-51.9,47.9,-51.9Z" transform="translate(100 100)" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <text x="50%" y="55%" text-anchor="middle" dominant-baseline="middle" font-size="50" font-weight="bold" fill="white" letter-spacing="2">TIFO</text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </svg>
Â  Â  Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <img src="../tifo.png" alt="TIFOã¡ã‚ƒã‚“" class="h-20 w-20 object-contain">
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <p class="text-lg text-gray-600 mb-8">è¦³å…‰çŒ«å‹AIã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒªãƒ¼</p>
Â  Â  Â  Â  <div id="loading-message" class="text-gray-600"><p>ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</p></div>
Â  Â  Â  Â  <div id="main-content" class="w-full max-w-md hidden">
Â  Â  Â  Â  Â  Â  <label for="facility-select" class="block mb-2 text-gray-700 font-bold">åˆ†æã—ãŸã„æ–½è¨­ã‚’é¸ã‚“ã§ã«ã‚ƒğŸ¾</label>
Â  Â  Â  Â  Â  Â  <select id="facility-select" class="w-full p-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-teal-400 focus:border-teal-400"></select>
Â  Â  Â  Â  Â  Â  <button id="analyze-button" class="tifo-button w-full mt-6">ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æ</button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="absolute bottom-4">
Â  Â  Â  Â  Â  Â  <button id="disclaimer-button" class="text-sm text-gray-500 hover:underline">å…è²¬äº‹é …</button>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  Â  Â  <div id="analysis-screen" class="hidden p-4 md:p-8 max-w-5xl mx-auto">
Â  Â  Â  Â  <header class="flex items-center justify-between mb-8">
Â  Â  Â  Â  Â  Â  <h1 id="facility-title" class="text-3xl font-bold"></h1>
Â  Â  Â  Â  Â  Â  <button id="back-button" class="tifo-button">æˆ»ã‚‹</button>
Â  Â  Â  Â  </header>

Â  Â  Â  Â  <main class="space-y-8">
Â  Â  Â  Â  Â  Â  <section>
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold mb-4 flex items-center">åŸºæœ¬ã‚¹ã‚³ã‚¢</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="tifo-card text-center"><h3 class="text-lg font-bold mb-2">å…¨å›ç­”æ•°</h3><p id="total-answers" class="text-6xl font-bold" style="color: var(--tifo-primary);"></p><p id="total-answers-rank" class="text-sm text-gray-500 mt-3"></p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="tifo-card text-center"><h3 class="text-lg font-bold mb-2">â¤ï¸ NPS (é¡§å®¢æ¨å¥¨åº¦)</h3><p id="nps-score" class="text-6xl font-bold" style="color: var(--tifo-primary);"></p><p class="text-xs text-gray-500">(-100 ~ 100ã®ç¯„å›²)</p><div class="w-full mt-3 relative"><div class="nps-bar-container"><div class="nps-bar-marker"></div><div id="nps-bar-value" class="nps-bar-value"></div></div></div><p id="nps-rank" class="text-sm text-gray-500 mt-3"></p></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold mb-4 flex items-center">å„ç¨®æº€è¶³åº¦ã‚¹ã‚³ã‚¢</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="tifo-card text-center"><h3 class="text-lg font-bold mb-2">ğŸ å•†å“ãƒ»ã‚µãƒ¼ãƒ“ã‚¹</h3><div class="flex items-baseline justify-center"><p id="product-satisfaction" class="text-5xl font-bold" style="color: var(--tifo-primary);"></p><span class="text-2xl font-bold text-gray-500">/ 5.0</span></div><div class="w-full progress-bar-bg mt-3"><div id="product-satisfaction-bar" class="progress-bar" style="height: 1rem;"></div></div><p id="product-satisfaction-rank" class="text-sm text-gray-500 mt-3"></p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="tifo-card text-center"><h3 class="text-lg font-bold mb-2">ğŸ¨ æ–½è¨­å…¨ä½“</h3><div class="flex items-baseline justify-center"><p id="facility-satisfaction" class="text-5xl font-bold" style="color: var(--tifo-primary);"></p><span class="text-2xl font-bold text-gray-500">/ 5.0</span></div><div class="w-full progress-bar-bg mt-3"><div id="facility-satisfaction-bar" class="progress-bar" style="height: 1rem;"></div></div><p id="facility-satisfaction-rank" class="text-sm text-gray-500 mt-3"></p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="tifo-card text-center"><h3 class="text-lg font-bold mb-2">ğŸš— æ—…å…¨ä½“</h3><div class="flex items-baseline justify-center"><p id="trip-satisfaction" class="text-5xl font-bold" style="color: var(--tifo-primary);"></p><span class="text-2xl font-bold text-gray-500">/ 5.0</span></div><div class="w-full progress-bar-bg mt-3"><div id="trip-satisfaction-bar" class="progress-bar" style="height: 1rem;"></div></div><p id="trip-satisfaction-rank" class="text-sm text-gray-500 mt-3"></p></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </section>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <section id="persona-section" class="tifo-card hidden">
Â  Â  Â  Â  Â  Â  Â  Â  Â <h2 class="text-2xl font-bold mb-2 flex items-center gap-3">ãƒšãƒ«ã‚½ãƒŠåˆ†æ</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â <p class="text-gray-600 mb-6">ã‚ãªãŸã®æ–½è¨­ã«æœ€ã‚‚å›ç­”ã—ã¦ã„ã‚‹é¡§å®¢ã‚°ãƒ«ãƒ¼ãƒ—TOP3ã§ã™ã€‚</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="persona-container" class="space-y-6"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â <template id="persona-template">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="border border-gray-200 rounded-xl p-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="flex items-center gap-4 mb-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="rank-badge"></span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <h3 class="text-xl font-bold text-gray-800"></h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="persona-details space-y-2 text-gray-700">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <p class="flex items-center gap-3"><span class="persona-companion-icon text-2xl w-8 text-center"></span> <span class="font-bold">åŒä¼´è€…:</span> <span class="persona-companion"></span></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <p class="flex items-center gap-3"><span class="persona-age-icon text-2xl w-8 text-center"></span> <span class="font-bold">å¹´ã€€ä»£:</span> <span class="persona-age"></span></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <p class="flex items-center gap-3"><span class="text-2xl w-8 text-center">ğŸ—¾</span> <span class="font-bold">åœ°ã€€æ–¹:</span> <span class="persona-region"></span></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <p class="flex items-center gap-3"><span class="text-2xl w-8 text-center">ğŸ’°</span> <span class="font-bold">å¹´ã€€å:</span> <span class="persona-income"></span></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="space-y-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <label class="font-bold text-gray-700">å›ç­”è€…å…¨ä½“ã«ãŠã‘ã‚‹å‰²åˆï¼ˆç¢ºåº¦ï¼‰</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="progress-bar-bg"><div class="progress-bar" style="width: 0%;"></div></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <p class="persona-counts text-right text-sm text-gray-500"></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â </template>
Â  Â  Â  Â  Â  Â  </section>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <section id="customer-voice-section">
Â  Â  Â  Â  Â  Â  Â  Â  Â <h2 class="text-2xl font-bold mb-4 flex items-center">ç›´è¿‘ï¼‘ã‹æœˆã®ãŠå®¢æ§˜ã®å£°</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="tifo-card !p-0 overflow-hidden">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="px-6 border-b border-gray-200">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <nav class="-mb-px flex space-x-2 overflow-x-auto" aria-label="Tabs">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button data-tab="service" class="feedback-tab-button active">å•†å“ãƒ»ã‚µãƒ¼ãƒ“ã‚¹</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button data-tab="facility" class="feedback-tab-button">æ–½è¨­å…¨ä½“</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button data-tab="inconvenience" class="feedback-tab-button">ä¸ä¾¿ãªç‚¹</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button data-tab="request" class="feedback-tab-button">ãƒªã‚¯ã‚¨ã‚¹ãƒˆ</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button data-tab="nps" class="feedback-tab-button">NPSã®ç†ç”±</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </nav>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="p-6 bg-gray-50">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="feedback-content-service" class="feedback-content custom-scrollbar space-y-4"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="feedback-content-facility" class="feedback-content custom-scrollbar space-y-4 hidden"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="feedback-content-inconvenience" class="feedback-content custom-scrollbar space-y-4 hidden"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="feedback-content-request" class="feedback-content custom-scrollbar space-y-4 hidden"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="feedback-content-nps" class="feedback-content custom-scrollbar space-y-4 hidden"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  </section>

Â  Â  Â  Â  Â  Â  <section id="ai-advice-section">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold mb-4 flex items-center">Tifoã¡ã‚ƒã‚“ã‹ã‚‰ã®AIã‚¢ãƒ‰ãƒã‚¤ã‚¹</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-stretch md:items-start gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="../tifo.png" alt="TIFOã¡ã‚ƒã‚“" class="h-32 w-32 object-contain flex-shrink-0 hidden md:block">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-white p-6 rounded-xl md:rounded-r-xl md:rounded-bl-xl relative w-full flex-1 border border-gray-200">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="absolute left-[-10px] top-[15px] w-0 h-0 border-t-[10px] border-t-transparent border-r-[10px] border-r-white border-b-[10px] border-b-transparent hidden md:block"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col h-full">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-gray-800 font-bold text-lg"><strong id="ai-advice-facility-name"></strong>ã•ã‚“ã¸</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-gray-600 mt-2">ãƒšãƒ«ã‚½ãƒŠã¨è‡ªç”±è¨˜è¿°ã®æ„è¦‹ã‚’å…ƒã«ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’è€ƒãˆãŸã«ã‚ƒğŸ¾</p>
Â  Â  Â  Â  Â  Â  Â  Â  _B_ Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="mt-auto pt-4 text-center md:text-right">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="open-ai-advice-btn" class="tifo-button">AIã‹ã‚‰ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’è¦‹ã‚‹</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </section>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <section>
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold mb-4 flex items-center">ã‚°ãƒ«ãƒ¼ãƒ—åˆ¥ æ¥è¨ªè€…TOP5</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="tifo-card"><h3 class="text-lg font-bold mb-4">ğŸš» æ€§åˆ¥</h3><ul id="gender-ranking" class="space-y-3"></ul></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="tifo-card"><h3 class="text-lg font-bold mb-4">ğŸ‚ å¹´ä»£</h3><ul id="age-ranking" class="space-y-3"></ul></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="tifo-card"><h3 class="text-lg font-bold mb-4">ğŸŒ™ å®¿æ³Šæ—¥æ•°</h3><ul id="stay-duration-ranking" class="space-y-3"></ul></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="tifo-card"><h3 class="text-lg font-bold mb-4">ğŸ‘ª åŒä¼´è€…</h3><ul id="companion-ranking" class="space-y-3"></ul></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="tifo-card col-span-1 md:col-span-2"><h3 class="text-lg font-bold mb-4">âœˆï¸ æ—…ã®ç›®çš„</h3><ul id="purpose-ranking" class="space-y-3"></ul></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="tifo-card col-span-1 md:col-span-2"><h3 class="text-lg font-bold mb-4">ğŸ’° ä¸–å¸¯å¹´å</h3><ul id="income-ranking" class="space-y-3"></ul></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="tifo-card col-span-1 md:col-span-2"><h3 class="text-lg font-bold mb-4">ğŸ—¾ éƒ½é“åºœçœŒ</h3><ul id="prefecture-ranking" class="space-y-3"></ul></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </section>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <section>
Â  Â  Â  Â  Â  Â  Â  Â  Â <h2 class="text-2xl font-bold mb-4 flex items-center">Tifoã¡ã‚ƒã‚“ã‹ã‚‰ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="flex items-start gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <img src="../tifo.png" alt="TIFOã¡ã‚ƒã‚“" class="h-32 w-32 object-contain flex-shrink-0">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="bg-white p-4 rounded-r-xl rounded-bl-xl relative w-full">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="absolute left-[-10px] top-[15px] w-0 h-0 border-t-[10px] border-t-transparent border-r-[10px] border-r-white border-b-[10px] border-b-transparent"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p id="tifo-advice-text" class="text-gray-700"></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  </section>

Â  Â  Â  Â  Â  Â  <div class="mt-8 flex justify-center">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="back-button-bottom" class="tifo-button">æˆ»ã‚‹</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </main>
Â  Â  </div>

Â  Â  Â  Â  <div id="disclaimer-modal" class="modal-overlay hidden">
Â  Â  Â  Â  <div class="modal-content !w-[600px]">
Â  Â  Â  Â  Â  Â  <div class="flex-shrink-0 flex justify-between items-center pb-4 mb-4 border-b">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold">å…è²¬äº‹é …</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="close-disclaimer-icon-btn" class="text-gray-400 hover:text-gray-600 transition-colors">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div id="disclaimer-text" class="flex-grow overflow-y-auto custom-scrollbar pr-2 text-sm text-gray-600 leading-relaxed space-y-2" style="max-height: 60vh;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="flex-shrink-0 pt-6">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="close-modal-button" class="tifo-button w-full">é–‰ã˜ã‚‹</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div id="ai-advice-modal" class="modal-overlay hidden">
Â  Â  Â  Â  <div class="modal-content">
Â  Â  Â  Â  Â  Â  <div class="flex-shrink-0 flex justify-between items-center border-b border-gray-200 pb-4 mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-xl font-bold text-gray-800">Tifoã¡ã‚ƒã‚“ã‹ã‚‰ã®AIã‚¢ãƒ‰ãƒã‚¤ã‚¹</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="close-ai-advice-modal-btn" class="text-gray-400 hover:text-gray-600 transition-colors">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div id="ai-advice-modal-body" class="flex-grow overflow-y-auto custom-scrollbar pr-2 whitespace-pre-wrap text-gray-700 leading-relaxed" style="max-height: 60vh;">
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  Â  Â  <div id="ranking-modal" class="modal-overlay hidden">
Â  Â  Â  Â  <div class="modal-content !w-[600px]">
Â  Â  Â  Â  Â  Â  <div class="flex-shrink-0 flex justify-between items-center pb-4 mb-4 border-b">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 id="ranking-modal-title" class="text-xl font-bold text-gray-800">ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="close-ranking-modal-btn" class="text-gray-400 hover:text-gray-600 transition-colors">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div id="ranking-modal-body" class="flex-grow overflow-y-auto custom-scrollbar pr-2" style="max-height: 65vh;">
Â  Â  Â  Â  Â  Â  Â  Â  <ol class="space-y-2" id="ranking-modal-list">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </ol>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  Â  <script>
document.addEventListener('DOMContentLoaded', async () => {
Â  Â  let surveyData = [];
Â  Â  let personaData = [];
Â  Â  let complainData = [];
Â  Â  let aiAdviceData = [];
Â  Â  let scoreFacilityKey = '';
Â  Â  let personaFacilityKey = '';
Â  Â  let adviceLines = [];

Â  Â  const homeScreen = document.getElementById('home-screen');
Â  Â  const analysisScreen = document.getElementById('analysis-screen');
Â  Â  const facilitySelect = document.getElementById('facility-select');
Â  Â  const analyzeButton = document.getElementById('analyze-button');
Â  Â  const backButton = document.getElementById('back-button');
Â  Â  const backButtonBottom = document.getElementById('back-button-bottom');
Â  Â  const loadingMessage = document.getElementById('loading-message');
Â  Â  const mainContent = document.getElementById('main-content');
Â  Â  const disclaimerButton = document.getElementById('disclaimer-button');
Â  Â  const disclaimerModal = document.getElementById('disclaimer-modal');
Â  Â  const closeModalButton = document.getElementById('close-modal-button');
Â  Â  const closeDisclaimerIconBtn = document.getElementById('close-disclaimer-icon-btn');
Â  Â Â 
Â  Â  const aiAdviceModal = document.getElementById('ai-advice-modal');
Â  Â  const openAiAdviceBtn = document.getElementById('open-ai-advice-btn');
Â  Â  const closeAiAdviceModalBtn = document.getElementById('close-ai-advice-modal-btn');
Â  Â  const aiAdviceModalBody = document.getElementById('ai-advice-modal-body');

Â  Â  // â–¼â–¼â–¼ ã€æ–°è¦è¿½åŠ ã€‘ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ¢ãƒ¼ãƒ€ãƒ«ã®DOMå‚ç…§ â–¼â–¼â–¼
Â  Â  const rankingModal = document.getElementById('ranking-modal');
Â  Â  const closeRankingModalBtn = document.getElementById('close-ranking-modal-btn');
Â  Â  const rankingModalTitle = document.getElementById('ranking-modal-title');
Â  Â  const rankingModalList = document.getElementById('ranking-modal-list');
Â  Â  // â–²â–²â–² ã€æ–°è¦è¿½åŠ ã€‘ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ¢ãƒ¼ãƒ€ãƒ«ã®DOMå‚ç…§ â–²â–²â–²

Â  Â  const complainColIndex = {
Â  Â  Â  Â  FACILITY: 1, TIMESTAMP: 2, SERVICE_SATISFACTION: 24, SERVICE_REASON: 25,
Â  Â  Â  Â  FACILITY_SATISFACTION: 26, FACILITY_REASON: 27, INCONVENIENCE: 28, INCONVENIENCE_REASON: 29,
Â  Â  Â  Â  NPS_SCORE: 30, REQUEST: 31, NPS_REASON: 42, BIRTH_YEAR: 35, PREFECTURE: 36, GENDER: 34,
Â  Â  };

Â  Â  function parseCSVWithHeaders(text) {
Â  Â  Â  Â  const lines = text.trim().replace(/\r/g, '').split('\n');
Â  Â  Â  Â  if (lines.length < 2) return { data: [], key: '' };
Â  Â  Â  Â  const headerLine = lines[0];
Â  Â  Â  Â  const regex = /(?:^|,)(?:"([^"]*(?:""[^"]*)*)"|([^,]*))/g;
Â  Â  Â  Â  const headers = [];
Â  Â  Â  Â  let match;
Â  Â  Â  Â  while(match = regex.exec(headerLine)) {
Â  Â  Â  Â  Â  Â  let value = match[1] ? match[1].replace(/""/g, '"') : match[2];
Â  Â  Â  Â  Â  Â  headers.push(value.trim());
Â  Â  Â  Â  }
Â  Â  Â  Â  const facilityKey = headers[0];
Â  Â  Â  Â  const data = lines.slice(1).map(line => {
Â  Â  Â  Â  Â  Â  const obj = {};
Â  Â  Â  Â  Â  Â  let i = 0;
Â  Â  Â  Â  Â  Â  regex.lastIndex = 0;
Â  Â  Â  Â  Â  Â  while(match = regex.exec(line)) {
Â  Â  Â  Â  Â  Â  Â  Â  if(i < headers.length) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const header = headers[i];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let value = match[1] ? match[1].replace(/""/g, '"') : match[2];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (value) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const numValue = Number(value);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  obj[header] = !isNaN(numValue) && value.trim() !== '' ? numValue : value.trim();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  obj[header] = null;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  i++;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  return obj;
Â  Â  Â  Â  });
Â  Â  Â  Â  return { data, key: facilityKey };
Â  Â  }
Â  Â Â 
Â  Â  function parseAIAdviceTSV(text) {
Â  Â  Â  Â  const allLines = text.trim().replace(/\r/g, '').split('\n');
Â  Â  Â  Â  if (allLines.length < 2) return { data: [], key: '' };
Â  Â  Â  Â  const headers = allLines.shift().split('\t').map(h => h.trim());
Â  Â  Â  Â  const facilityKey = headers.includes('æ–½è¨­å') ? 'æ–½è¨­å' : headers[0];
Â  Â  Â  Â  const data = [];
Â  Â  Â  Â  let currentObject = null;
Â  Â  Â  Â  for (const line of allLines) {
Â  Â  Â  Â  Â  Â  const parts = line.split('\t');
Â  Â  Â  Â  Â  Â  if (parts.length > 2) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (currentObject) data.push(currentObject);
Â  Â  Â  Â  Â  Â  Â  Â  currentObject = {};
Â  Â  Â  Â  Â  Â  Â  Â  headers.forEach((header, i) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentObject[header] = (parts[i] || '').trim().replace(/^"|"$/g, '');
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  if (currentObject) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const lastHeader = headers[headers.length - 1];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentObject[lastHeader] += '\n' + line.trim().replace(/^"|"$/g, '');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  if (currentObject) data.push(currentObject);
Â  Â  Â  Â  return { data, key: facilityKey };
Â  Â  }

Â  Â  function parseTSVAsArrays(text) {
Â  Â  Â  Â  const lines = text.trim().replace(/\r/g, '').split('\n');
Â  Â  Â  Â  if (lines.length < 2) return [];
Â  Â  Â  Â  return lines.slice(1).map(line => line.split('\t').map(val => val.trim()));
Â  Â  }

Â  Â  async function fetchAndParse(url, format = 'csv') {
Â  Â  Â  Â  const response = await fetch(url);
Â  Â  Â  Â  if (!response.ok) throw new Error(`Failed to load ${url}: ${response.statusText}`);
Â  Â  Â  Â  const text = await response.text();
Â  Â  Â  Â  const cleanText = text.charCodeAt(0) === 0xFEFF ? text.slice(1) : text;
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (format === 'ai-advice-tsv') {
Â  Â  Â  Â  Â  Â  return parseAIAdviceTSV(cleanText);
Â  Â  Â  Â  }
Â  Â  Â  Â  if (format === 'tsv-array') {Â 
Â  Â  Â  Â  Â  Â  return parseTSVAsArrays(cleanText);
Â  Â  Â  Â  }
Â  Â  Â  Â  return parseCSVWithHeaders(cleanText);
Â  Â  }

Â  Â  const handleRouteChange = () => {
Â  Â  Â  Â  const hash = location.hash.substring(1);
Â  Â  Â  Â  const facilityNameFromHash = decodeURIComponent(hash);
Â  Â  Â  Â  if (facilityNameFromHash && surveyData.length > 0) {
Â  Â  Â  Â  Â  Â  const facilityData = surveyData.find(d => d[scoreFacilityKey] === facilityNameFromHash);
Â  Â  Â  Â  Â  Â  if (facilityData) {
Â  Â  Â  Â  Â  Â  Â  Â  displayAnalysis(facilityData);
Â  Â  Â  Â  Â  Â  Â  Â  homeScreen.classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  analysisScreen.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  facilitySelect.value = facilityNameFromHash;
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  homeScreen.classList.remove('hidden');
Â  Â  Â  Â  analysisScreen.classList.add('hidden');
Â  Â  };

Â  Â  async function loadData() {
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const loadingStatus = loadingMessage.querySelector('p');

Â  Â  Â  Â  Â  Â  loadingStatus.textContent = 'ã‚¹ã‚³ã‚¢ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...';
Â  Â  Â  Â  Â  Â  const scoreResult = await fetchAndParse('./milli_score.csv');
Â  Â  Â  Â  Â  Â  surveyData = scoreResult.data;
Â  Â  Â  Â  Â  Â  scoreFacilityKey = scoreResult.key;

Â  Â  Â  Â  Â  Â  loadingStatus.textContent = 'ãƒšãƒ«ã‚½ãƒŠãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...';
Â  Â  Â  Â  Â  Â  const personaResult = await fetchAndParse('./milli_persona.csv');
Â  Â  Â  Â  Â  Â  personaData = personaResult.data;
Â  Â  Â  Â  Â  Â  personaFacilityKey = personaResult.key;

Â  Â  Â  Â  Â  Â  loadingStatus.textContent = 'å£ã‚³ãƒŸãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...';
Â  Â  Â  Â  Â  Â  complainData = await fetchAndParse('./milli_complain.tsv', 'tsv-array');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  loadingStatus.textContent = 'AIã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’æº–å‚™ä¸­...';
Â  Â  Â  Â  Â  Â  const aiAdviceResult = await fetchAndParse('./milli_ai_advice.tsv', 'ai-advice-tsv');
Â  Â  Â  Â  Â  Â  aiAdviceData = aiAdviceResult.data;

Â  Â  Â  Â  Â  Â  loadingStatus.textContent = 'è¿½åŠ ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...';
Â  Â  Â  Â  Â  Â  const adviceResponse = await fetch('../tifo_advice.txt').catch(e => null);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (surveyData.length === 0) throw new Error("No valid data rows found in milli_score.csv.");
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  surveyData = surveyData.filter(row => row && row[scoreFacilityKey] && String(row[scoreFacilityKey]).trim() !== '');
Â  Â  Â  Â  Â  Â  surveyData.sort((a, b) => (Number(b['å…¨å›ç­”æ•°']) || 0) - (Number(a['å…¨å›ç­”æ•°']) || 0));
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (adviceResponse && adviceResponse.ok) {
Â  Â  Â  Â  Â  Â  Â  Â  const adviceText = await adviceResponse.text();
Â  Â  Â  Â  Â  Â  Â  Â  adviceLines = adviceText.trim().split(/\r?\n/).filter(line => line.trim() !== '');
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  surveyData.forEach(data => {
Â  Â  Â  Â  Â  Â  Â  Â  const option = document.createElement('option');
Â  Â  Â  Â  Â  Â  Â  Â  option.value = data[scoreFacilityKey];
Â  Â  Â  Â  Â  Â  Â  Â  option.textContent = data[scoreFacilityKey];
Â  Â  Â  Â  Â  Â  Â  Â  facilitySelect.appendChild(option);
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  loadingMessage.classList.add('hidden');
Â  Â  Â  Â  Â  Â  mainContent.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  handleRouteChange();
Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  console.error("Full error object:", error);
Â  Â  Â  Â  Â  Â  loadingMessage.innerHTML = `<p class="text-red-500 font-bold">ã‚¨ãƒ©ãƒ¼: ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</p><p class="text-sm mt-2">${error.message}</p>`;
Â  Â  Â  Â  }
Â  Â  }

Â  Â  analyzeButton.addEventListener('click', () => { location.hash = encodeURIComponent(facilitySelect.value); });
Â  Â  backButton.addEventListener('click', () => { location.hash = ''; });
Â  Â  backButtonBottom.addEventListener('click', () => { location.hash = ''; });
Â  Â  window.addEventListener('hashchange', handleRouteChange);
Â  Â nbsp;
Â  Â  // â–¼â–¼â–¼ å…è²¬äº‹é …ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ä¿®æ­£ â–¼â–¼â–¼
Â  Â  const openDisclaimerModal = async () => {
Â  Â  Â  Â  Â try {
Â  Â  Â  Â  Â  Â  const response = await fetch('../credit.txt');
Â  Â  Â  Â  Â  Â  if (!response.ok) throw new Error('File not found');
Â  Â  Â  Â  Â  Â  const text = await response.text();
Â  Â  Â  Â  Â  Â  document.getElementById('disclaimer-text').innerHTML = text.replace(/\n/g, '<br>');
Â  Â  Â  Â  Â  Â  disclaimerModal.classList.remove('hidden');
Â  Â  Â  Â  } catch(e) {
Â  Â  Â  Â  Â  Â  document.getElementById('disclaimer-text').textContent = 'å…è²¬äº‹é …ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚';
Â  Â  Â  Â  Â  Â  disclaimerModal.classList.remove('hidden');
Â  Â  Â  Â  }
Â  Â  };
Â  Â  const closeDisclaimerModal = () => {
Â  Â  Â  Â  disclaimerModal.classList.add('hidden');
Â  Â  };
Â  Â  disclaimerButton.addEventListener('click', openDisclaimerModal);
Â  Â  closeModalButton.addEventListener('click', closeDisclaimerModal);
Â  Â  closeDisclaimerIconBtn.addEventListener('click', closeDisclaimerModal);
Â  Â  disclaimerModal.addEventListener('click', (e) => { if(e.target === disclaimerModal) closeDisclaimerModal(); });

Â  Â  openAiAdviceBtn.addEventListener('click', () => {
Â  Â  Â  Â  const facilityName = facilitySelect.value;
Â  Â  Â  Â  const adviceInfo = aiAdviceData.find(d => d['æ–½è¨­å'] === facilityName);
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (adviceInfo && adviceInfo['AIã‚¢ãƒ‰ãƒã‚¤ã‚¹']) {
Â  Â  Â  Â  Â  Â  aiAdviceModalBody.textContent = adviceInfo['AIã‚¢ãƒ‰ãƒã‚¤ã‚¹'];
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  aiAdviceModalBody.textContent = 'ã“ã®æ–½è¨­ã«é–¢ã™ã‚‹AIã‚¢ãƒ‰ãƒã‚¤ã‚¹ã¯ç¾åœ¨ã‚ã‚Šã¾ã›ã‚“ã€‚';
Â  Â  Â  Â  }
Â  Â  Â  Â  aiAdviceModal.classList.remove('hidden');
Â  Â  });

Â  Â  closeAiAdviceModalBtn.addEventListener('click', () => {
Â  Â  Â  Â  aiAdviceModal.classList.add('hidden');
Â  Â  });

Â  Â  aiAdviceModal.addEventListener('click', (e) => {
Â  Â  Â  Â  if (e.target === aiAdviceModal) {
Â  Â  Â  Â  Â  Â  aiAdviceModal.classList.add('hidden');
Â  Â  Â  Â  }
Â  Â  });

Â  Â  // â–¼â–¼â–¼ ã€æ–°è¦è¿½åŠ ã€‘ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ â–¼â–¼â–¼
Â  Â  const closeRankingModal = () => {
Â  Â  Â  Â  rankingModal.classList.add('hidden');
Â  Â  };
Â  Â  closeRankingModalBtn.addEventListener('click', closeRankingModal);
Â  Â  rankingModal.addEventListener('click', (e) => {
Â  Â  Â  Â  if (e.target === rankingModal) closeRankingModal();
Â  Â  });
Â  Â  // â–²â–²â–² ã€æ–°è¦è¿½åŠ ã€‘ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ â–²â–²â–²

Â  Â  // â–¼â–¼â–¼ ã€æ–°è¦è¿½åŠ ã€‘ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¨ˆç®—ï¼†ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºé–¢æ•° â–¼â–¼â–¼
Â  Â  function showRankingModal(dataKey, friendlyName) {
Â  Â  Â  Â  if (!surveyData || surveyData.length === 0) return;

Â  Â  Â  Â  // 1. ãƒ‡ãƒ¼ã‚¿ã‚’è¨ˆç®—ãƒ»ã‚½ãƒ¼ãƒˆ
Â  Â  Â  Â  const rankedFacilities = surveyData
Â  Â  Â  Â  Â  Â  .map(facility => ({
Â  Â  Â  Â  Â  Â  Â  Â  name: facility[scoreFacilityKey],
Â  Â  Â  Â  Â  Â  Â  Â  percentage: (Number(facility[dataKey]) || 0) * 100 // æ—¢ã«å‰²åˆ(0-1)ãªã®ã§100ã‚’æ›ã‘ã‚‹
Â  Â  Â  Â  Â  Â  }))
Â  Â  Â  Â  Â  Â  .filter(facility => facility.percentage > 0.001) // 0%ã¯é™¤å¤– (å¾®å°ãªå€¤ã‚‚è€ƒæ…®)
Â  Â  Â  Â  Â  Â  .sort((a, b) => b.percentage - a.percentage) // é™é †ã‚½ãƒ¼ãƒˆ
Â  Â  Â  Â  Â  Â  .slice(0, 30); // TOP30

Â  Â  Â  Â  // 2. ãƒ¢ãƒ¼ãƒ€ãƒ«ã«ãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®š
Â  Â  Â  Â  rankingModalTitle.textContent = `ã€Œ${friendlyName}ã€ã®å‰²åˆãŒå¤šã„æ–½è¨­ TOP30`;
Â  Â  Â  Â  rankingModalList.innerHTML = ''; // ãƒªã‚¹ãƒˆã‚’ã‚¯ãƒªã‚¢

Â  Â  Â  Â  if (rankedFacilities.length === 0) {
Â  Â  Â  Â  Â  Â  rankingModalList.innerHTML = '<li class="list-none text-gray-500 p-4 text-center">è©²å½“ã™ã‚‹æ–½è¨­ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</li>';
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  rankedFacilities.forEach((facility, index) => {
Â  Â  Â  Â  Â  Â  Â  Â  const li = document.createElement('li');
Â  Â  Â  Â  Â  Â  Â  Â  li.className = 'flex items-center justify-between p-2 rounded-lg hover:bg-gray-50';
Â  Â  Â  Â  Â  Â  Â  Â  // é †ä½ã«å¿œã˜ã¦èƒŒæ™¯è‰²ã‚’å°‘ã—å¤‰ãˆã‚‹
Â  Â  Â  Â  Â  Â  Â  Â  if (index === 0) li.classList.add('!bg-yellow-50'); 
Â  Â  Â  Â  Â  Â  Â  Â  if (index === 1) li.classList.add('!bg-gray-100'); 
Â  Â  Â  Â  Â  Â  Â  Â  if (index === 2) li.classList.add('!bg-orange-50'); 
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  li.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center truncate">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-bold text-gray-700 w-8 text-right mr-3 flex-shrink-0">${index + 1}.</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="flex-1 truncate" title="${facility.name}">${facility.name}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-bold text-lg ml-4 flex-shrink-0" style="color: var(--tifo-primary);">${facility.percentage.toFixed(1)}%</span>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  rankingModalList.appendChild(li);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  // 3. ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
Â  Â  Â  Â  rankingModal.classList.remove('hidden');
Â  Â  }
Â  Â  // â–²â–²â–² ã€æ–°è¦è¿½åŠ ã€‘ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¨ˆç®—ï¼†ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºé–¢æ•° â–²â–²â–²


Â  Â  function getRank(value, dataKey) {
Â  Â  Â  Â  if (value === null || value === undefined) return { rank: 'N/A', total: surveyData.length };
Â  Â  Â  Â  const sortedValues = surveyData.map(d => Number(d[dataKey]) || -Infinity).sort((a, b) => b - a);
Â  Â  Â  Â  const rank = sortedValues.indexOf(Number(value)) + 1;
Â  Â  Â  Â  return { rank, total: surveyData.length };
Â  Â  }
Â  Â  function updateSatisfactionCard(idPrefix, score, dataKey) {
Â  Â  Â  Â  const scoreValue = (score && !isNaN(score)) ? Number(score) : 0;
Â  Â  Â  Â  document.getElementById(`${idPrefix}`).textContent = scoreValue.toFixed(2);
Â  Â  Â  Â  document.getElementById(`${idPrefix}-bar`).style.width = `${(scoreValue / 5) * 100}%`;
Â  Â  Â  Â  const rankInfo = getRank(score, dataKey);
Â  Â  Â  Â  document.getElementById(`${idPrefix}-rank`).textContent = `(å…¨${rankInfo.total}æ–½è¨­ä¸­ ${rankInfo.rank}ä½)`;
Â  Â  }
Â  Â  function getTopN(groups, n) {
Â  Â  Â  Â  return Object.entries(groups).filter(([key, value]) => Number(value) > 0 && key !== 'null' && key !== 'undefined').sort(([, a], [, b]) => Number(b) - Number(a)).slice(0, n);
F Â  }
Â  Â Â 
Â  Â  // â–¼â–¼â–¼ ã€ä¿®æ­£ã€‘renderRankingList é–¢æ•° (ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¿½åŠ ) â–¼â–¼â–¼
Â  Â  function renderRankingList(elementId, topData, nameMap) {
Â  Â  Â  Â  const listElement = document.getElementById(elementId);
Â  Â  Â  Â  listElement.innerHTML = '';
Â  Â  Â  Â  if (topData.length === 0) {
Â  Â  Â  Â  Â  Â  listElement.innerHTML = '<li class="text-gray-500">è©²å½“ãƒ‡ãƒ¼ã‚¿ãªã—</li>';
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  topData.forEach(([dataKey, value], index) => {
Â  Â  Â  Â  Â  Â  const percentage = (Number(value) * 100).toFixed(1);
Â  Â  Â  Â  Â  Â  // nameMap ã‹ã‚‰è¡¨ç¤ºåã‚’å–å¾—ã€‚è¦‹ã¤ã‹ã‚‰ãªã‘ã‚Œã° dataKey ã‚’ãã®ã¾ã¾ä½¿ç”¨
Â  Â  Â  Â  Â  Â  const friendlyName = (nameMap && nameMap[dataKey]) ? nameMap[dataKey] : dataKey;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const li = document.createElement('li');
Â  Â  Â  Â  Â  Â  // ã‚«ãƒ¼ã‚½ãƒ«ã‚’ãƒã‚¤ãƒ³ã‚¿ãƒ¼ã«ã—ã€ãƒ›ãƒãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’è¿½åŠ 
Â  Â  Â  Â  Â  Â  li.className = 'flex items-center cursor-pointer hover:bg-gray-100 p-1 -m-1 rounded-md transition-colors'; 
Â  Â  Â  Â  Â  Â  li.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <span class="rank-badge rank-${index + 1}">${index + 1}</span>
Â  Â  Â  Â  Â  Â  Â  Â  <span class="ml-3 flex-1">${friendlyName}</span>
Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-bold">${percentage}%</span>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // data-* å±æ€§ã«ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ¼ã¨è¡¨ç¤ºåã‚’è¨­å®š
Â  Â  Â  Â  Â  Â  li.dataset.key = dataKey;
Â  Â  Â  Â  Â  Â  li.dataset.name = friendlyName;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
Â  Â  Â  Â  Â  Â  li.addEventListener('click', (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  const key = e.currentTarget.dataset.key;
Â  Â  Â  Â  Â  Â  Â  Â  const name = e.currentTarget.dataset.name;
Â  Â  Â  Â  Â  Â  Â  Â  if (key && surveyData.some(d => d[key] !== undefined)) { // surveyDataã«ã‚­ãƒ¼ãŒå­˜åœ¨ã™ã‚‹ã‹ç°¡æ˜“ãƒã‚§ãƒƒã‚¯
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showRankingModal(key, name);
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.warn(`Ranking data key "${key}" not found or invalid.`);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  listElement.appendChild(li);
Â  Â  Â  Â  });
Â  Â  }
Â  Â  // â–²â–²â–² ã€ä¿®æ­£ã€‘renderRankingList é–¢æ•° â–²â–²â–²
Â  Â Â 
Â  Â  function displayPersonaAnalysis(scoreData, facilityName) {
Â  Â  Â  Â  const personaSection = document.getElementById('persona-section');
Â  Â  Â  Â  const container = document.getElementById('persona-container');
Â  Â  Â  Â  const template = document.getElementById('persona-template');
Â  Â  Â  Â  container.innerHTML = '';
Â  Â  Â  Â  const personaRow = personaData.find(p => p[personaFacilityKey] === facilityName);
Â  Â  Â  Â  if (!personaRow) {
Â  Â  Â  Â  Â  Â  personaSection.classList.add('hidden');
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  const personas = [];
Â  Â  Â  Â  for (let i = 1; i <= 3; i++) {
Â  Â  Â  Â  Â  Â  if (personaRow[`ps${i}_ã‚«ã‚¦ãƒ³ãƒˆ`]) {
Â  Â  Â  Â  Â  Â  Â  Â  personas.push({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  rank: i,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  companion: personaRow[`ps${i}_åŒä¼´è€…`],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  age: personaRow[`ps${i}_å¹´ä»£`],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  region: personaRow[`ps${i}_åœ°æ–¹`],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  income: personaRow[`ps${i}_å¹´å`],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  count: personaRow[`ps${i}_ã‚«ã‚¦ãƒ³ãƒˆ`],
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  if (personas.length === 0) {
Â  Â  Â  Â  Â  Â  personaSection.classList.add('hidden');
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  const companionIcons = { "å®¶æ—é€£ã‚Œ": "ğŸ‘ª", "2äººçµ„": "ğŸ‘«", "å‹äºº": "ğŸ§‘â€ğŸ¤â€ğŸ§‘", "default": "ğŸ‘¤" };
Â  Â  Â  Â  const ageIcons = { "è‹¥å¹´å±¤": "ğŸ‘¦", "ä¸­å¹´å±¤": "ğŸ‘¨â€ğŸ’¼", "é«˜é½¢å±¤": "ğŸ‘µ", "default": "ğŸ‘¤" };
Â  Â  Â  Â  const rankClasses = ["rank-1", "rank-2", "rank-3"];
Â  Â  Â  Â  const rankTitles = ["ãƒšãƒ«ã‚½ãƒŠï¼‘", "ãƒšãƒ«ã‚½ãƒŠï¼’", "ãƒšãƒ«ã‚½ãƒŠï¼“"];
Â  Â  Â  Â  const totalAnswers = Number(scoreData['å…¨å›ç­”æ•°']);
Â  Â  Â  Â  personas.forEach((persona, index) => {
Â  Â  Â  Â  Â  Â  const clone = template.content.cloneNode(true);
Â  Â  Â  Â  Â  Â  const card = clone.querySelector('.border');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const rankBadge = card.querySelector('.rank-badge');
Â  Â  Â  Â  Â  Â  rankBadge.textContent = persona.rank;
Â  Â  Â  Â  Â  Â  rankBadge.classList.add(rankClasses[index]);
Â  Â  Â  Â  Â  Â  card.querySelector('h3').textContent = rankTitles[index];
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  card.querySelector('.persona-companion').textContent = persona.companion;
Â  Â  Â  Â  Â  Â  card.querySelector('.persona-age').textContent = persona.age;
Â  Â  Â  Â  Â  Â  card.querySelector('.persona-region').textContent = persona.region;
Â  Â  Â  Â  Â  Â  card.querySelector('.persona-income').textContent = persona.income;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  card.querySelector('.persona-companion-icon').textContent = companionIcons[persona.companion] || companionIcons.default;
Â  Â  Â  Â  Â  Â  card.querySelector('.persona-age-icon').textContent = ageIcons[persona.age] || ageIcons.default;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const certaintyPercent = totalAnswers > 0 ? (Number(persona.count) / totalAnswers) * 100 : 0;
Â  Â  Â  Â  Â  Â  const barWidthPercent = Math.min(100, (certaintyPercent / 25) * 100);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const progressBar = card.querySelector('.progress-bar');
Â  Â  Â  Â  Â  Â  progressBar.style.width = `${barWidthPercent}%`;
Â  Â  Â  Â  Â  Â  progressBar.textContent = `${certaintyPercent.toFixed(1)}%`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  card.querySelector('.persona-counts').textContent = `è©²å½“ã‚«ã‚¦ãƒ³ãƒˆ: ${persona.count}ä»¶ / å…¨å›ç­”æ•° ${totalAnswers}ä»¶`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  container.appendChild(clone);
Â  Â  Â  Â  });
Â  Â  Â  Â  personaSection.classList.remove('hidden');
Â  Â  }

Â  Â  function displayCustomerFeedback(facilityName) {
Â  Â  Â  Â  const satisfactionInfo = {
Â  Â  Â  Â  Â  Â  'ã¨ã¦ã‚‚æº€è¶³': { icon: 'M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z', color: 'green', label: 'ã¨ã¦ã‚‚æº€è¶³' },
Â  Â  Â  Â  Â  Â  'æº€è¶³': { icon: 'M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z', color: 'blue', label: 'æº€è¶³' },
Â  Â  Â  Â  Â  Â  'ã©ã¡ã‚‰ã§ã‚‚ãªã„': { icon: 'M8 12h.01M12 12h.01M16 12h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z', color: 'yellow', label: 'ã©ã¡ã‚‰ã§ã‚‚ãªã„' },
Â  Â  Â  Â  Â  Â  'ä¸æº€': { icon: 'M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z', color: 'red', label: 'ä¸æº€' },
Â  Â  Â  Â  Â  Â  'ã¨ã¦ã‚‚ä¸æº€': { icon: 'M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636', color: 'gray', label: 'ã¨ã¦ã‚‚ä¸æº€' },
Â  Â  Â  Â  Â  Â  'æ„Ÿã˜ãŸ': { icon: 'M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z', color: 'orange', label: 'ä¸ä¾¿ã‚’æ„Ÿã˜ãŸ' },
Â  Â  Â  Â  Â  Â  'request': { icon: 'M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z', color: 'cyan', label: 'ãƒªã‚¯ã‚¨ã‚¹ãƒˆ' },
Â  Â  Â  Â  Â  Â  'nps': { icon: 'M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z', color: 'purple', label: 'NPSã®ç†ç”±' },
Â  Â  Â  Â  };
Â  Â  Â  Â  const colorClasses = {
Â  Â  Â  Â  Â  Â  green: { icon: 'text-green-500', label: 'text-green-800', bg: 'bg-green-100' },
Â  Â  Â  Â  Â  Â  blue: { icon: 'text-blue-500', label: 'text-blue-800', bg: 'bg-blue-100' },
Â  Â  Â  Â  Â  Â  yellow: { icon: 'text-yellow-500', label: 'text-yellow-800', bg: 'bg-yellow-100' },
Â  Â  Â  Â  Â  Â  red: { icon: 'text-red-500', label: 'text-red-800', bg: 'bg-red-100' },
Â  Â  Â  Â  Â  Â  gray: { icon: 'text-gray-500', label: 'text-gray-800', bg: 'bg-gray-200' },
Â  Â  Â  Â  Â  Â  orange: { icon: 'text-orange-500', label: 'text-orange-800', bg: 'bg-orange-100' },
Â  Â  Â  Â  Â  Â  cyan: { icon: 'text-cyan-500', label: 'text-cyan-800', bg: 'bg-cyan-100' },
Â  Â  Â  Â  Â  Â  purple: { icon: 'text-purple-500', label: 'text-purple-800', bg: 'bg-purple-100' },
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  const filteredData = complainData
Â  Â  Â  Â  Â  Â  .filter(row => row && row[complainColIndex.FACILITY] === facilityName)
Â  Â  Â  Â  Â  Â  .sort((a, b) => new Date(b[complainColIndex.TIMESTAMP]) - new Date(a[complainColIndex.TIMESTAMP]));

Â  Â  Â  Â  const feedback = { service: [], facility: [], inconvenience: [], request: [], nps: [] };
Â  Â  Â  Â Â 
Â  Â  Â  Â  filteredData.forEach(row => {
Â  Â  Â  Â  Â  Â  const commonData = {
Â  Â  Â  Â  Â  Â  Â  Â  year: row[complainColIndex.BIRTH_YEAR] || 'ä¸æ˜',
Â  Â  Â  Â  Â  Â  Â  Â  prefecture: row[complainColIndex.PREFECTURE] || 'ä¸æ˜',
Â  Â  Â  Â  Â  Â  Â  Â  gender: row[complainColIndex.GENDER] || 'ä¸æ˜'
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  const serviceReason = row[complainColIndex.SERVICE_REASON];
Â  Â  Â  Â  Â  Â  if (serviceReason) feedback.service.push({ ...commonData, text: serviceReason, satisfaction: row[complainColIndex.SERVICE_SATISFACTION] });

Â  Â  Â  Â  Â  Â  const facilityReason = row[complainColIndex.FACILITY_REASON];
Â  Â  Â  Â  Â  Â  if (facilityReason) feedback.facility.push({ ...commonData, text: facilityReason, satisfaction: row[complainColIndex.FACILITY_SATISFACTION] });

Â  Â  Â  Â  Â  Â  const inconvenienceReason = row[complainColIndex.INCONVENIENCE_REASON];
Â  Â  Â  Â  Â  Â  if (row[complainColIndex.INCONVENIENCE] === 'æ„Ÿã˜ãŸ' && inconvenienceReason) feedback.inconvenience.push({ ...commonData, text: inconvenienceReason, satisfaction: 'æ„Ÿã˜ãŸ' });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const requestText = row[complainColIndex.REQUEST];
Â  Â  Â  Â  Â  Â  if (requestText) feedback.request.push({ ...commonData, text: requestText });

Â  Â  Â  Â  Â  Â  const npsReason = row[complainColIndex.NPS_REASON];
Â  Â  Â  Â  Â  Â  if (npsReason) {
Â  Â  Â  Â  Â  Â  Â  Â  feedback.nps.push({ ...commonData, text: npsReason, score: row[complainColIndex.NPS_SCORE] });
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  const createCommentCard = (comment, type) => {
Â  Â  Â  Â  Â  Â  let infoKey = type === 'request' || type === 'nps' ? type : comment.satisfaction;
Â  Â  Â  Â  Â  Â  const info = satisfactionInfo[infoKey];
Â  Â  Â  Â  Â  Â  if (!info || !comment.text) return '';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const colors = colorClasses[info.color];
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const isNps = type === 'nps';
Â  Â  Â  Â  Â  Â  const npsScoreBadge = isNps && comment.score !== undefined
Â  Â  Â  Â  Â  Â  Â  Â  ? `<span class="ml-auto text-xs font-bold px-2 py-1 rounded-full bg-purple-200 text-purple-800">è©•ä¾¡: ${comment.score}ç‚¹</span>`
Â  Â  Â  Â  Â  Â  Â  Â  : '';
Â  Â  Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-white p-4 rounded-lg border border-gray-200">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-start space-x-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-shrink-0 mt-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg class="w-6 h-6 ${colors.icon}" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${info.icon}"></path></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-1 min-w-0">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="px-2 py-0.5 text-xs font-semibold rounded-full ${colors.bg} ${colors.label} inline-block">${info.label}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${npsScoreBadge}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="mt-2 text-gray-700 text-sm leading-relaxed break-words">${comment.text}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="mt-3 text-xs text-gray-500">${comment.year}å¹´ç”Ÿã¾ã‚Œãƒ»${comment.prefecture}åœ¨ä½ãƒ»${comment.gender}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  };

Â  Â  Â  Â  const renderComments = (containerId, comments, type) => {
Â  Â  Â  Â  Â  Â  const container = document.getElementById(containerId);
Â  Â  Â  Â  Â  Â  if (comments.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = comments.map(c => createCommentCard(c, type)).join('');
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = `<div class="text-center text-gray-500 py-16">è©²å½“ã™ã‚‹ã‚³ãƒ¡ãƒ³ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</div>`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  renderComments('feedback-content-service', feedback.service, 'service');
Â  Â  Â  Â  renderComments('feedback-content-facility', feedback.facility, 'facility');
Â  Â  Â  Â  renderComments('feedback-content-inconvenience', feedback.inconvenience, 'inconvenience');
Â  Â  Â  Â  renderComments('feedback-content-request', feedback.request, 'request');
Â  Â  Â  Â  renderComments('feedback-content-nps', feedback.nps, 'nps');
Â  Â  Â  Â Â 
Â  Â  Â  Â  const tabs = document.querySelectorAll('.feedback-tab-button');
Â  Â  Â  Â  const contents = document.querySelectorAll('.feedback-content');
Â  Â  Â  Â Â 
Â  Â  Â  Â  tabs.forEach(tab => {
Â  Â  Â  Â  Â  Â  tab.addEventListener('click', (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  Â  Â  tabs.forEach(t => t.classList.remove('active'));
Â  Â  Â  Â  Â  Â  Â  Â  tab.classList.add('active');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  contents.forEach(c => c.classList.add('hidden'));
Â  Â  Â  Â  Â  Â  Â  Â  const contentId = `feedback-content-${tab.dataset.tab}`;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById(contentId).classList.remove('hidden');
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  // åˆæœŸã‚¿ãƒ–ã‚’è¨­å®š
Â  Â  Â  Â  const activeTab = document.querySelector('.feedback-tab-button.active');
Â  Â  Â  Â  if (activeTab) {
Â  Â  Â  Â  Â  Â  contents.forEach(c => c.classList.add('hidden'));
Â  Â  Â  Â  Â  Â  document.getElementById(`feedback-content-${activeTab.dataset.tab}`).classList.remove('hidden');
Â  Â  Â  Â  } else if (tabs.length > 0) {
Â  Â  Â  Â  Â  Â  tabs[0].classList.add('active');
Â  Â  Â  Â  Â  Â  contents.forEach(c => c.classList.add('hidden'));
Â  Â  Â  Â  Â  Â  document.getElementById(`feedback-content-${tabs[0].dataset.tab}`).classList.remove('hidden');
Â  Â  Â  Â  }
Â  Â  }

Â  Â  // â–¼â–¼â–¼ ã€å¤§å¹…ä¿®æ­£ã€‘displayAnalysis é–¢æ•° (ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ¼ã¨è¡¨ç¤ºåã®ãƒãƒƒãƒ”ãƒ³ã‚°) â–¼â–¼â–¼
Â  Â  function displayAnalysis(data) {
Â  Â  Â  Â  const facilityName = data[scoreFacilityKey];
Â  Â  Â  Â  document.getElementById('facility-title').textContent = `${facilityName} ã®åˆ†æçµæœ`;
Â  Â  Â  Â Â 
Â  Â  Â  Â  document.getElementById('ai-advice-facility-name').textContent = facilityName;
Â  Â  Â  Â Â 
Â  Â  Â  Â  document.getElementById('total-answers').textContent = data['å…¨å›ç­”æ•°'] ?? 'N/A';
Â  Â  Â  Â  const answersRank = getRank(data['å…¨å›ç­”æ•°'], 'å…¨å›ç­”æ•°');
Â  Â  Â  Â  document.getElementById('total-answers-rank').textContent = `(å…¨${answersRank.total}æ–½è¨­ä¸­ ${answersRank.rank}ä½)`;
Â  Â  Â  Â Â 
Â  Â  Â  Â  const nps = data.NPS;
Â  Â  Â  Â  const npsScore = nps !== null && nps !== undefined ? (Number(nps) * 100).toFixed(1) : 'N/A';
Â  Â  Â  Â  document.getElementById('nps-score').textContent = npsScore;
Â  Â  Â  Â  const normalizedNpsPercent = nps !== null && nps !== undefined ? (Number(nps) * 100 + 100) / 2 : 50;
Â  Â  Â  Â  document.getElementById('nps-bar-value').style.left = `calc(${normalizedNpsPercent}% - 0.375rem)`;
Â  Â  Â  Â  const npsRank = getRank(data.NPS, 'NPS');
Â  Â  Â  Â  document.getElementById('nps-rank').textContent = `(å…¨${npsRank.total}æ–½è¨­ä¸­ ${npsRank.rank}ä½)`;
Â  Â  Â  Â Â 
Â  Â  Â  Â  updateSatisfactionCard('product-satisfaction', data['å•†å“ãƒ»ã‚µãƒ¼ãƒ“ã‚¹æº€è¶³åº¦'], 'å•†å“ãƒ»ã‚µãƒ¼ãƒ“ã‚¹æº€è¶³åº¦');
Â  Â  Â  Â  updateSatisfactionCard('facility-satisfaction', data['æ–½è¨­å…¨ä½“æº€è¶³åº¦'], 'æ–½è¨­å…¨ä½“æº€è¶³åº¦');
Â  Â  Â  Â  updateSatisfactionCard('trip-satisfaction', data['æ—…å…¨ä½“æº€è¶³åº¦'], 'æ—…å…¨ä½“æº€è¶³åº¦');
Â  Â  Â  Â Â 
Â  Â  Â  Â  displayPersonaAnalysis(data, facilityName);
Â  Â  Â  Â  displayCustomerFeedback(facilityName);
Â  Â  Â  Â Â 
Â  Â  Â  Â  // --- ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ¼ (surveyDataã®ã‚«ãƒ©ãƒ å) ã¨è¡¨ç¤ºåã®ãƒãƒƒãƒ”ãƒ³ã‚° ---
Â  Â  Â  Â  const dataKeyToFriendlyName = {
Â  Â  Â  Â  Â  Â  // å¹´ä»£ (ã‚­ãƒ¼ã¨è¡¨ç¤ºåãŒåŒã˜)
Â  Â  Â  Â  Â  Â  '10ä»£': '10ä»£', '20ä»£': '20ä»£', '30ä»£': '30ä»£', '40ä»£': '40ä»£', '50ä»£': '50ä»£', '60ä»£': '60ä»£', '70ä»£': '70ä»£', '80ä»£': '80ä»£', '90ä»£': '90ä»£', '100ä»£': '100ä»£',
Â  Â  Â  Â  Â  Â  // æ€§åˆ¥ (ã‚­ãƒ¼ã¨è¡¨ç¤ºåãŒåŒã˜)
Â  Â  Â  Â  Â  Â  'ç”·æ€§': 'ç”·æ€§', 'å¥³æ€§': 'å¥³æ€§',
Â  Â  Â  Â  Â  Â  // å®¿æ³Š (ã‚­ãƒ¼ã¨è¡¨ç¤ºåãŒåŒã˜)
Â  Â  Â  Â  Â  Â  'æ—¥å¸°ã‚Š': 'æ—¥å¸°ã‚Š', '1æ³Š': '1æ³Š', '2æ³Š': '2æ³Š', '3æ³Š': '3æ³Š', '4æ³Šä»¥ä¸Š': '4æ³Šä»¥ä¸Š',
Â  Â  Â  Â  Â  Â  // åŒä¼´è€…
Â  Â  Â  Â  Â  Â  'è‡ªåˆ†ã²ã¨ã‚Š': 'ã²ã¨ã‚Šæ—…', 'æ‹äºº': 'æ‹äººã¨', 'å‹äºº': 'å‹äººã¨', 'å¤«å©¦2äºº': 'å¤«å©¦2äºº', 'å›£ä½“æ—…è¡Œ': 'å›£ä½“æ—…è¡Œ', 'è¦ªæˆš': 'è¦ªæˆšã¨', 'è¦ª': 'è¦ªã¨', 'è·å ´ã®åŒåƒš': 'è·å ´ã®åŒåƒšã¨', 'å°å­¦ç”Ÿä»¥ä¸‹é€£ã‚Œã®å®¶æ—': 'å®¶æ—(å°å­¦ç”Ÿä»¥ä¸‹)', 'ä¸­å­¦ç”Ÿä»¥ä¸‹é€£ã‚Œã®å®¶æ—': 'å®¶æ—(ä¸­å­¦ç”Ÿ)', 'é«˜æ ¡ç”Ÿé€£ã‚Œã®å®¶æ—': 'å®¶æ—(é«˜æ ¡ç”Ÿ)',
Â  Â  Â  Â  Â  Â  // æ—…ã®ç›®çš„
Â  Â  Â  Â  Â  Â  'å®¿ã§ã®ã‚“ã³ã‚Šéã”ã™': 'å®¿ã§ã®ã‚“ã³ã‚Š', 'æ¸©æ³‰ã‚„éœ²å¤©é¢¨å‘‚': 'æ¸©æ³‰', 'åœ°å…ƒã®ç¾å‘³ã—ã„ã‚‚ã®ã‚’é£Ÿã¹ã‚‹': 'ã‚°ãƒ«ãƒ¡', 'èŠ±è¦‹ã‚„ç´…è‘‰ãªã©ã®è‡ªç„¶é‘‘è³': 'è‡ªç„¶é‘‘è³', 'åæ‰€ã€æ—§è·¡ã®è¦³å…‰': 'åæ‰€ãƒ»æ—§è·¡è¦³å…‰', 'ãƒ†ãƒ¼ãƒãƒ‘ãƒ¼ã‚¯ï¼ˆéŠåœ’åœ°ã€å‹•ç‰©åœ’ã€åšç‰©é¤¨ãªã©ï¼‰': 'ãƒ†ãƒ¼ãƒãƒ‘ãƒ¼ã‚¯', 'è²·ã„ç‰©ã€ã‚¢ã‚¦ãƒˆãƒ¬ãƒƒãƒˆ': 'è²·ã„ç‰©', 'ãŠç¥­ã‚Šã‚„ã‚¤ãƒ™ãƒ³ãƒˆã¸ã®å‚åŠ ãƒ»è¦‹ç‰©': 'ã‚¤ãƒ™ãƒ³ãƒˆ', 'ã‚¹ãƒãƒ¼ãƒ„è¦³æˆ¦ã‚„èŠ¸èƒ½é‘‘è³ï¼ˆã‚³ãƒ³ã‚µãƒ¼ãƒˆç­‰ï¼‰': 'é‘‘è³', 'ã‚¢ã‚¦ãƒˆãƒ‰ã‚¢ï¼ˆæµ·æ°´æµ´ã€é‡£ã‚Šã€ç™»å±±ãªã©ï¼‰': 'ã‚¢ã‚¦ãƒˆãƒ‰ã‚¢', 'ã¾ã¡ã‚ã‚‹ãã€éƒ½å¸‚æ•£ç­–': 'ã¾ã¡ã‚ã‚‹ã', 'å„ç¨®ä½“é¨“ï¼ˆæ‰‹ä½œã‚Šã€æœç‰©ç‹©ã‚Šãªã©ï¼‰': 'ä½“é¨“', 'ã‚¹ã‚­ãƒ¼ãƒ»ã‚¹ãƒãƒœã€ãƒãƒªãƒ³ã‚¹ãƒãƒ¼ãƒ„': 'ã‚¹ãƒãƒ¼ãƒ„(ã‚¹ã‚­ãƒ¼/ã‚¹ãƒãƒœç­‰)', 'ãã®ä»–ã‚¹ãƒãƒ¼ãƒ„ï¼ˆã‚´ãƒ«ãƒ•ã€ãƒ†ãƒ‹ã‚¹ãªã©ï¼‰': 'ã‚¹ãƒãƒ¼ãƒ„(ã‚´ãƒ«ãƒ•/ãƒ†ãƒ‹ã‚¹ç­‰)', 'ãƒ‰ãƒ©ã‚¤ãƒ–ãƒ»ãƒ„ãƒ¼ãƒªãƒ³ã‚°': 'ãƒ‰ãƒ©ã‚¤ãƒ–', 'å‹äººãƒ»è¦ªæˆšã‚’å°‹ã­ã‚‹': 'çŸ¥äººè¨ªå•', 'å‡ºå¼µãªã©ä»•äº‹é–¢ä¿‚': 'ä»•äº‹é–¢ä¿‚',
Â  Â  Â  Â  Â  Â  // å¹´å
Â  Â  Â  Â  Â  Â  '100ä¸‡å††æœªæº€': '100ä¸‡å††æœªæº€', '100ä¸‡å††ä»¥ä¸Š 200ä¸‡å††æœªæº€': '100-200ä¸‡å††', '200ä¸‡å††ä»¥ä¸Š 300ä¸‡å††æœªæº€': '200-300ä¸‡å††', '300ä¸‡å††ä»¥ä¸Š 400ä¸‡å††æœªæº€': '300-400ä¸‡å††', '400ä¸‡å††ä»¥ä¸Š 500ä¸‡å††æœªæº€': '400-500ä¸‡å††', '500ä¸‡å††ä»¥ä¸Š 600ä¸‡å††æœªæº€': '500-600ä¸‡å††', '600ä¸‡å††ä»¥ä¸Š 700ä¸‡å††æœªæº€': '600-700ä¸‡å††', '700ä¸‡å††ä»¥ä¸Š 800ä¸‡å††æœªæº€': '700-800ä¸‡å††', '800ä¸‡å††ä»¥ä¸Š 900ä¸‡å††æœªæº€': '800-900ä¸‡å††', '900ä¸‡å††ä»¥ä¸Š 1,000ä¸‡å††æœªæº€': '900-1000ä¸‡å††', '1,000ä¸‡å††ä»¥ä¸Š 1,200ä¸‡å††æœªæº€': '1000-1200ä¸‡å††', '1,200ä¸‡å††ä»¥ä¸Š 1,500ä¸‡å††æœªæº€': '1200-1500ä¸‡å††', '1,500ä¸‡å††ä»¥ä¸Š': '1500ä¸‡å††ä»¥ä¸Š',
Â  Â  Â  Â  Â  Â  // éƒ½é“åºœçœŒ (ã‚­ãƒ¼ã¨è¡¨ç¤ºåãŒåŒã˜)
Â  Â  Â  Â  Â  Â  'åŒ—æµ·é“': 'åŒ—æµ·é“', 'é’æ£®çœŒ': 'é’æ£®çœŒ', 'å²©æ‰‹çœŒ': 'å²©æ‰‹çœŒ', 'å®®åŸçœŒ': 'å®®åŸçœŒ', 'ç§‹ç”°çœŒ': 'ç§‹ç”°çœŒ', 'å±±å½¢çœŒ': 'å±±å½¢çœŒ', 'ç¦å³¶çœŒ': 'ç¦å³¶çœŒ', 'èŒ¨åŸçœŒ': 'èŒ¨åŸçœŒ', 'æ ƒæœ¨çœŒ': 'æ ƒæœ¨çœŒ', 'ç¾¤é¦¬çœŒ': 'ç¾¤é¦¬çœŒ', 'åŸ¼ç‰çœŒ': 'åŸ¼ç‰çœŒ', 'åƒè‘‰çœŒ': 'åƒè‘‰çœŒ', 'æ±äº¬éƒ½': 'æ±äº¬éƒ½', 'ç¥å¥ˆå·çœŒ': 'ç¥å¥ˆå·çœŒ', 'æ–°æ½ŸçœŒ': 'æ–°æ½ŸçœŒ', 'å¯Œå±±çœŒ': 'å¯Œå±±çœŒ', 'çŸ³å·çœŒ': 'çŸ³å·çœŒ', 'ç¦äº•çœŒ': 'ç¦äº•çœŒ', 'å±±æ¢¨çœŒ': 'å±±æ¢¨çœŒ', 'é•·é‡çœŒ': 'é•·é‡çœŒ', 'å²é˜œçœŒ': 'å²é˜œçœŒ', 'é™å²¡çœŒ': 'é™å²¡çœŒ', 'æ„›çŸ¥çœŒ': 'æ„›çŸ¥çœŒ', 'ä¸‰é‡çœŒ': 'ä¸‰é‡çœŒ', 'æ»‹è³€çœŒ': 'æ»‹è³€çœŒ', 'äº¬éƒ½åºœ': 'äº¬éƒ½åºœ', 'å¤§é˜ªåºœ': 'å¤§é˜ªåºœ', 'å…µåº«çœŒ': 'å…µåº«çœŒ', 'å¥ˆè‰¯çœŒ': 'å¥ˆè‰¯çœŒ', 'å’Œæ­Œå±±çœŒ': 'å’Œæ­Œå±±çœŒ', 'é³¥å–çœŒ': 'é³¥å–çœŒ', 'å³¶æ ¹çœŒ': 'å³¶æ ¹çœŒ', 'å²¡å±±çœŒ': 'å²¡å±±çœŒ', 'åºƒå³¶çœŒ': 'åºƒå³¶çœŒ', 'å±±å£çœŒ': 'å±±å£çœŒ', 'å¾³å³¶çœŒ': 'å¾³å³¶çœŒ', 'é¦™å·çœŒ': 'é¦™å·çœŒ', 'æ„›åª›çœŒ': 'æ„›åª›çœŒ', 'é«˜çŸ¥çœŒ': 'é«˜çŸ¥çœŒ', 'ç¦å²¡çœŒ': 'ç¦å²¡çœŒ', 'ä½è³€çœŒ': 'ä½è³€çœŒ', 'é•·å´çœŒ': 'é•·å´çœŒ', 'ç†Šæœ¬çœŒ': 'ç†Šæœ¬çœŒ', 'å¤§åˆ†çœŒ': 'å¤§åˆ†çœŒ', 'å®®å´çœŒ': 'å®®å´çœŒ', 'é¹¿å…å³¶çœŒ': 'é¹¿å…å³¶çœŒ', 'æ²–ç¸„çœŒ': 'æ²–ç¸„çœŒ'
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  // --- å„ã‚°ãƒ«ãƒ¼ãƒ—ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ (ã‚­ãƒ¼ã¯ surveyData ã®ã‚«ãƒ©ãƒ å) ---
Â  Â  Â  Â  const ageGroups = { '10ä»£': data['10ä»£'], '20ä»£': data['20ä»£'], '30ä»£': data['30ä»£'], '40ä»£': data['40ä»£'], '50ä»£': data['50ä»£'], '60ä»£': data['60ä»£'], '70ä»£': data['70ä»£'], '80ä»£': data['80ä»£'], '90ä»£': data['90ä»£'], '100ä»£': data['100ä»£'] };
Â  Â  Â  Â  const genderGroups = { 'ç”·æ€§': data['ç”·æ€§'], 'å¥³æ€§': data['å¥³æ€§'] };
Â  Â  Â  Â  const stayDurationGroups = { 'æ—¥å¸°ã‚Š': data['æ—¥å¸°ã‚Š'], '1æ³Š': data['1æ³Š'], '2æ³Š': data['2æ³Š'], '3æ³Š': data['3æ³Š'], '4æ³Šä»¥ä¸Š': data['4æ³Šä»¥ä¸Š'] };
Â  Â  Â  Â  const companionGroups = { 'è‡ªåˆ†ã²ã¨ã‚Š': data['è‡ªåˆ†ã²ã¨ã‚Š'], 'æ‹äºº': data['æ‹äºº'], 'å‹äºº': data['å‹äºº'], 'å¤«å©¦2äºº': data['å¤«å©¦2äºº'], 'å›£ä½“æ—…è¡Œ': data['å›£ä½“æ—…è¡Œ'], 'è¦ªæˆš': data['è¦ªæˆš'], 'è¦ª': data['è¦ª'], 'è·å ´ã®åŒåƒš': data['è·å ´ã®åŒåƒš'], 'å°å­¦ç”Ÿä»¥ä¸‹é€£ã‚Œã®å®¶æ—': data['å°å­¦ç”Ÿä»¥ä¸‹é€£ã‚Œã®å®¶æ—'], 'ä¸­å­¦ç”Ÿä»¥ä¸‹é€£ã‚Œã®å®¶æ—': data['ä¸­å­¦ç”Ÿä»¥ä¸‹é€£ã‚Œã®å®¶æ—'], 'é«˜æ ¡ç”Ÿé€£ã‚Œã®å®¶æ—': data['é«˜æ ¡ç”Ÿé€£ã‚Œã®å®¶æ—'] };
Â  Â  Â  Â  const purposeGroups = { 
Â  Â  Â  Â  Â  Â  'å®¿ã§ã®ã‚“ã³ã‚Šéã”ã™': data['å®¿ã§ã®ã‚“ã³ã‚Šéã”ã™'], 'æ¸©æ³‰ã‚„éœ²å¤©é¢¨å‘‚': data['æ¸©æ³‰ã‚„éœ²å¤©é¢¨å‘‚'], 'åœ°å…ƒã®ç¾å‘³ã—ã„ã‚‚ã®ã‚’é£Ÿã¹ã‚‹': data['åœ°å…ƒã®ç¾å‘³ã—ã„ã‚‚ã®ã‚’é£Ÿã¹ã‚‹'], 
Â  Â  Â  Â  Â  Â  'èŠ±è¦‹ã‚„ç´…è‘‰ãªã©ã®è‡ªç„¶é‘‘è³': data['èŠ±è¦‹ã‚„ç´…è‘‰ãªã©ã®è‡ªç„¶é‘‘è³'], 'åæ‰€ã€æ—§è·¡ã®è¦³å…‰': data['åæ‰€ã€æ—§è·¡ã®è¦³å…‰'], 'ãƒ†ãƒ¼ãƒãƒ‘ãƒ¼ã‚¯ï¼ˆéŠåœ’åœ°ã€å‹•ç‰©åœ’ã€åšç‰©é¤¨ãªã©ï¼‰': data['ãƒ†ãƒ¼ãƒãƒ‘ãƒ¼ã‚¯ï¼ˆéŠåœ’åœ°ã€å‹•ç‰©åœ’ã€åšç‰©é¤¨ãªã©ï¼‰'], 
Â  Â  Â  Â  Â  Â  'è²·ã„ç‰©ã€ã‚¢ã‚¦ãƒˆãƒ¬ãƒƒãƒˆ': data['è²·ã„ç‰©ã€ã‚¢ã‚¦ãƒˆãƒ¬ãƒƒãƒˆ'], 'ãŠç¥­ã‚Šã‚„ã‚¤ãƒ™ãƒ³ãƒˆã¸ã®å‚åŠ ãƒ»è¦‹ç‰©': data['ãŠç¥­ã‚Šã‚„ã‚¤ãƒ™ãƒ³ãƒˆã¸ã®å‚åŠ ãƒ»è¦‹ç‰©'], 'ã‚¹ãƒãƒ¼ãƒ„è¦³æˆ¦ã‚„èŠ¸èƒ½é‘‘è³ï¼ˆã‚³ãƒ³ã‚µãƒ¼ãƒˆç­‰ï¼‰': data['ã‚¹ãƒãƒ¼ãƒ„è¦³æˆ¦ã‚„èŠ¸èƒ½é‘‘è³ï¼ˆã‚³ãƒ³ã‚µãƒ¼ãƒˆç­‰ï¼‰'], 
Â  Â  Â  Â  Â  Â  'ã‚¢ã‚¦ãƒˆãƒ‰ã‚¢ï¼ˆæµ·æ°´æµ´ã€é‡£ã‚Šã€ç™»å±±ãªã©ï¼‰': data['ã‚¢ã‚¦ãƒˆãƒ‰ã‚¢ï¼ˆæµ·æ°´æµ´ã€é‡£ã‚Šã€ç™»å±±ãªã©ï¼‰'], 'ã¾ã¡ã‚ã‚‹ãã€éƒ½å¸‚æ•£ç­–': data['ã¾ã¡ã‚ã‚‹ãã€éƒ½å¸‚æ•£ç­–'], 'å„ç¨®ä½“é¨“ï¼ˆæ‰‹ä½œã‚Šã€æœç‰©ç‹©ã‚Šãªã©ï¼‰': data['å„ç¨®ä½“é¨“ï¼ˆæ‰‹ä½œã‚Šã€æœç‰©ç‹©ã‚Šãªã©ï¼‰'], 
Â  Â  Â  Â  Â  Â  'ã‚¹ã‚­ãƒ¼ãƒ»ã‚¹ãƒãƒœã€ãƒãƒªãƒ³ã‚¹ãƒãƒ¼ãƒ„': data['ã‚¹ã‚­ãƒ¼ãƒ»ã‚¹ãƒãƒœã€ãƒãƒªãƒ³ã‚¹ãƒãƒ¼ãƒ„'], 'ãã®ä»–ã‚¹ãƒãƒ¼ãƒ„ï¼ˆã‚´ãƒ«ãƒ•ã€ãƒ†ãƒ‹ã‚¹ãªã©ï¼‰': data['ãã®ä»–ã‚¹ãƒãƒ¼ãƒ„ï¼ˆã‚´ãƒ«ãƒ•ã€ãƒ†ãƒ‹ã‚¹ãªã©ï¼‰'], 
Â  Â  Â  Â  Â  Â  'ãƒ‰ãƒ©ã‚¤ãƒ–ãƒ»ãƒ„ãƒ¼ãƒªãƒ³ã‚°': data['ãƒ‰ãƒ©ã‚¤ãƒ–ãƒ»ãƒ„ãƒ¼ãƒªãƒ³ã‚°'], 'å‹äººãƒ»è¦ªæˆšã‚’å°‹ã­ã‚‹': data['å‹äººãƒ»è¦ªæˆšã‚’å°‹ã­ã‚‹'], 'å‡ºå¼µãªã©ä»•äº‹é–¢ä¿‚': data['å‡ºå¼µãªã©ä»•äº‹é–¢ä¿‚'] 
Â  Â  Â  Â  };
Â  Â  Â  Â  const incomeGroups = {
Â  Â  Â  Â  Â  Â  '100ä¸‡å††æœªæº€': data['100ä¸‡å††æœªæº€'], '100ä¸‡å††ä»¥ä¸Š 200ä¸‡å††æœªæº€': data['100ä¸‡å††ä»¥ä¸Š 200ä¸‡å††æœªæº€'], '200ä¸‡å††ä»¥ä¸Š 300ä¸‡å††æœªæº€': data['200ä¸‡å††ä»¥ä¸Š 300ä¸‡å††æœªæº€'],
Â  Â  Â  Â  Â  Â  '300ä¸‡å††ä»¥ä¸Š 400ä¸‡å††æœªæº€': data['300ä¸‡å††ä»¥ä¸Š 400ä¸‡å††æœªæº€'], '400ä¸‡å††ä»¥ä¸Š 500ä¸‡å††æœªæº€': data['400ä¸‡å††ä»¥ä¸Š 500ä¸‡å††æœªæº€'], '500ä¸‡å††ä»¥ä¸Š 600ä¸‡å††æœªæº€': data['500ä¸‡å††ä»¥ä¸Š 600ä¸‡å††æœªæº€'],
Â  Â  Â  Â  Â  Â  '600ä¸‡å††ä»¥ä¸Š 700ä¸‡å††æœªæº€': data['600ä¸‡å††ä»¥ä¸Š 700ä¸‡å††æœªæº€'], '700ä¸‡å††ä»¥ä¸Š 800ä¸‡å††æœªæº€': data['700ä¸‡å††ä»¥ä¸Š 800ä¸‡å††æœªæº€'], '800ä¸‡å††ä»¥ä¸Š 900ä¸‡å††æœªæº€': data['800ä¸‡å††ä»¥ä¸Š 900ä¸‡å††æœªæº€'],
Â  Â  Â  Â  Â  Â  '900ä¸‡å††ä»¥ä¸Š 1,000ä¸‡å††æœªæº€': data['900ä¸‡å††ä»¥ä¸Š 1,000ä¸‡å††æœªæº€'], '1,000ä¸‡å††ä»¥ä¸Š 1,200ä¸‡å††æœªæº€': data['1,000ä¸‡å††ä»¥ä¸Š 1,200ä¸‡å††æœªæº€'], '1,200ä¸‡å††ä»¥ä¸Š 1,500ä¸‡å††æœªæº€': data['1,200ä¸‡å††ä»¥ä¸Š 1,500ä¸‡å††æœªæº€'],
Â  Â  Â  Â  Â  Â  '1,500ä¸‡å††ä»¥ä¸Š': data['1,500ä¸‡å††ä»¥ä¸Š']
Â  Â  Â  Â  };
Â  Â  Â  Â  const prefectureGroups = {
Â  Â  Â  Â  Â  Â  'åŒ—æµ·é“': data['åŒ—æµ·é“'], 'é’æ£®çœŒ': data['é’æ£®çœŒ'], 'å²©æ‰‹çœŒ': data['å²©æ‰‹çœŒ'], 'å®®åŸçœŒ': data['å®®åŸçœŒ'], 'ç§‹ç”°çœŒ': data['ç§‹ç”°çœŒ'], 'å±±å½¢çœŒ': data['å±±å½¢çœŒ'], 'ç¦å³¶çœŒ': data['ç¦å³¶çœŒ'],
Â  Â  Â  Â  Â  Â  'èŒ¨åŸçœŒ': data['èŒ¨åŸçœŒ'], 'æ ƒæœ¨çœŒ': data['æ ƒæœ¨çœŒ'], 'ç¾¤é¦¬çœŒ': data['ç¾¤é¦¬çœŒ'], 'åŸ¼ç‰çœŒ': data['åŸ¼ç‰çœŒ'], 'åƒè‘‰çœŒ': data['åƒè‘‰çœŒ'], 'æ±äº¬éƒ½': data['æ±äº¬éƒ½'], 'ç¥å¥ˆå·çœŒ': data['ç¥å¥ˆå·çœŒ'],
Â  Â  Â  Â  Â  Â  'æ–°æ½ŸçœŒ': data['æ–°æ½ŸçœŒ'], 'å¯Œå±±çœŒ': data['å¯Œå±±çœŒ'], 'çŸ³å·çœŒ': data['çŸ³å·çœŒ'], 'ç¦äº•çœŒ': data['ç¦äº•çœŒ'], 'å±±æ¢¨çœŒ': data['å±±æ¢¨çœŒ'], 'é•·é‡çœŒ': data['é•·é‡çœŒ'], 'å²é˜œçœŒ': data['å²é˜œçœŒ'],
Â  Â  Â  Â  Â  Â  'é™å²¡çœŒ': data['é™å²¡çœŒ'], 'æ„›çŸ¥çœŒ': data['æ„›çŸ¥çœŒ'], 'ä¸‰é‡çœŒ': data['ä¸‰é‡çœŒ'], 'æ»‹è³€çœŒ': data['æ»‹è³€çœŒ'], 'äº¬éƒ½åºœ': data['äº¬éƒ½åºœ'], 'å¤§é˜ªåºœ': data['å¤§é˜ªåºœ'], 'å…µåº«çœŒ': data['å…µåº«çœŒ'],
Â  Â  Â  Â  Â  Â  'å¥ˆè‰¯çœŒ': data['å¥ˆè‰¯çœŒ'], 'å’Œæ­Œå±±çœŒ': data['å’Œæ­Œå±±çœŒ'], 'é³¥å–çœŒ': data['é³¥å–çœŒ'], 'å³¶æ ¹çœŒ': data['å³¶æ ¹çœŒ'], 'å²¡å±±çœŒ': data['å²¡å±±çœŒ'], 'åºƒå³¶çœŒ': data['åºƒå³¶çœŒ'], 'å±±å£çœŒ': data['å±±å£çœŒ'],
T Â  Â  Â  Â  'å¾³å³¶çœŒ': data['å¾³å³¶çœŒ'], 'é¦™å·çœŒ': data['é¦™å·çœŒ'], 'æ„›åª›çœŒ': data['æ„›åª›çœŒ'], 'é«˜çŸ¥çœŒ': data['é«˜çŸ¥çœŒ'], 'ç¦å²¡çœŒ': data['ç¦å²¡çœŒ'], 'ä½è³€çœŒ': data['ä½è³€çœŒ'], 'é•·å´çœŒ': data['é•·å´çœŒ'],
Â  Â  Â  Â  Â  Â  'ç†Šæœ¬çœŒ': data['ç†Šæœ¬çœŒ'], 'å¤§åˆ†çœŒ': data['å¤§åˆ†çœŒ'], 'å®®å´çœŒ': data['å®®å´çœŒ'], 'é¹¿å…å³¶çœŒ': data['é¹¿å…å³¶çœŒ'], 'æ²–ç¸„çœŒ': data['æ²–ç¸„çœŒ']
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  // --- renderRankingListå‘¼ã³å‡ºã— (nameMap ã‚’æ¸¡ã™) ---
Â  Â  Â  Â  renderRankingList('age-ranking', getTopN(ageGroups, 5), dataKeyToFriendlyName);
Â  Â  Â  Â  renderRankingList('gender-ranking', getTopN(genderGroups, 5), dataKeyToFriendlyName);
Â  Â  Â  Â  renderRankingList('stay-duration-ranking', getTopN(stayDurationGroups, 5), dataKeyToFriendlyName);
Â  Â  Â  Â  renderRankingList('companion-ranking', getTopN(companionGroups, 5), dataKeyToFriendlyName);
Â  Â  Â  Â  renderRankingList('purpose-ranking', getTopN(purposeGroups, 5), dataKeyToFriendlyName);
Â  Â  Â  Â  renderRankingList('income-ranking', getTopN(incomeGroups, 5), dataKeyToFriendlyName);
Â  Â  Â  Â  renderRankingList('prefecture-ranking', getTopN(prefectureGroups, 5), dataKeyToFriendlyName);
Â  Â  Â  Â Â 
Â  Â  Â  Â  const adviceContainer = document.getElementById('tifo-advice-text');
Â  Â  Â  Â  let finalAdvice = 'åˆ†æãƒ‡ãƒ¼ã‚¿ã‚’å…ƒã«ã€ã•ã‚‰ãªã‚‹æ”¹å–„ç‚¹ã‚’æ¢ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼';
Â  Â  Â  Â  if (adviceLines.length > 0) {
Â  Â  Â  Â  Â  Â  const randomIndex = Math.floor(Math.random() * adviceLines.length);
Â  Â  Â  Â  Â  Â  finalAdvice = adviceLines[randomIndex];
Â  Â  Â  Â  }
Â  Â  Â  Â  adviceContainer.innerHTML = `<strong>${facilityName}ã•ã‚“ã¸</strong><br><br>${finalAdvice}`;
Â  Â  }
Â  Â  // â–²â–²â–² ã€å¤§å¹…ä¿®æ­£ã€‘displayAnalysis é–¢æ•° â–²â–²â–²

Â  Â  loadData();
});
</script>

</body>
</html>
